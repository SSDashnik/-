<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Товары - Магазин косметики</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Каталог товаров</h1>
            <nav class="nav-menu">
                <a href="{{ url_for('products.list_products') }}">Товары</a>
                <a href="{{ url_for('sales.create_sale_form') }}">Оформить продажу</a>
                {% if is_director %}
                <a href="{{ url_for('sales.list_sales') }}">Все продажи</a>
                <a href="{{ url_for('sales.statistics') }}">Статистика</a>
                <a href="{{ url_for('products.discounts') }}">Скидки</a>
                <a href="{{ url_for('users.list_users') }}">Пользователи</a>
                {% else %}
                <a href="{{ url_for('sales.my_sales') }}">Мои продажи</a>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}">Выход</a>
            </nav>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="filters">
            <h2>Фильтры</h2>
            <form method="GET" class="filter-form">
                <input type="text" name="search" placeholder="Поиск по названию..." value="{{ search_term }}">
                <select name="category">
                    <option value="">Все категории</option>
                    {% for cat in categories %}
                    <option value="{{ cat }}" {% if cat == current_category %}selected{% endif %}>{{ cat }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="button primary">Применить</button>
                <a href="{{ url_for('products.list_products') }}" class="button">Сбросить</a>
            </form>
        </div>

        {% if is_director %}
        <div class="actions">
            <a href="{{ url_for('products.create_form') }}" class="button primary">Добавить товар</a>
        </div>
        {% endif %}

        <div class="products-grid">
            {% if products %}
                {% for product in products %}
                <div class="product-card">
                    <h3>{{ product.name }}</h3>
                    {% if product.article %}
                    <p class="category">Артикул: {{ product.article }}</p>
                    {% endif %}
                    {% if product.package %}
                    <p class="category">Упаковка: {{ product.package }}</p>
                    {% endif %}
                    <p class="category">Категория: {{ product.category }}</p>
                    {% if product.discount_price %}
                    <p class="price" style="text-decoration: line-through; color: #999;">Цена: {{ "%.2f"|format(product.price) }} руб.</p>
                    <p class="price" style="color: #d4a5a5;">Цена со скидкой: {{ "%.2f"|format(product.discount_price) }} руб.</p>
                    {% else %}
                    <p class="price">Цена: {{ "%.2f"|format(product.price) }} руб.</p>
                    {% endif %}
                    <p class="stock">Остаток: {{ product.stock_quantity }} шт.</p>
                    {% if product.description %}
                    <p class="description">{{ product.description }}</p>
                    {% endif %}
                    {% if is_director %}
                    <div class="product-actions">
                        <a href="{{ url_for('products.edit_form', product_id=product.id) }}" class="button small">Редактировать</a>
                        <form method="POST" action="{{ url_for('products.delete_product', product_id=product.id) }}" style="display: inline;">
                            <button type="submit" class="button small danger" onclick="return confirm('Удалить товар?')">Удалить</button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>Товары не найдены</p>
            {% endif %}
        </div>
    </div>
</body>
</html>

