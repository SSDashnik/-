СТРУКТУРА ПРОЕКТА "МАГАЗИН КОСМЕТИКИ"
========================================

КОРНЕВАЯ ДИРЕКТОРИЯ
--------------------
cosmeticshop1/
├── app/                          # Основная директория приложения
├── .venv/                        # Виртуальное окружение Python (опционально)
├── requirements.txt              # Зависимости проекта
├── test_cosmeticshop.py          # Файл с 25 юнит-тестами
└── project_structure.txt         # Этот файл - описание структуры

APP/ - ОСНОВНАЯ ДИРЕКТОРИЯ ПРИЛОЖЕНИЯ
-------------------------------------
app/
├── startservice.py               # Точка входа приложения, инициализация Flask
│                                  # - Создание приложения Flask
│                                  # - Настройка базы данных SQLite
│                                  # - Регистрация blueprints (контроллеров)
│                                  # - Инициализация Flask-Login
│                                  # - Создание тестовых пользователей при первом запуске
│
├── models/                        # МОДЕЛИ (Model в MVC)
│   ├── __init__.py               # Инициализация моделей, создание единого экземпляра db
│   ├── user.py                   # Модель пользователя
│   │                             # - Класс User: пользователи системы
│   │                             # - Поля: id, username, password_hash, role, full_name, created_at
│   │                             # - Роли: ROLE_CASHIER (кассир), ROLE_DIRECTOR (директор)
│   │                             # - Класс UserRepo: репозиторий для работы с пользователями
│   │                             #   (CRUD операции, поиск по username, фильтрация по ролям)
│   │
│   ├── product.py                # Модель товара
│   │                             # - Класс Product: товары косметики
│   │                             # - Поля: id, name, article (артикул), package (упаковка),
│   │                             #         category, price, discount_price (цена со скидкой),
│   │                             #         stock_quantity (остаток), description, created_at
│   │                             # - Класс ProductRepo: репозиторий для работы с товарами
│   │                             #   (CRUD, фильтрация по категории, названию)
│   │
│   └── sale.py                   # Модель продажи
│                                 # - Класс Sale: продажи товаров
│                                 # - Поля: id, product_id, cashier_id, quantity, total_price, sale_date
│                                 # - Класс SaleRepo: репозиторий для работы с продажами
│                                 #   (создание продажи, получение по кассиру/товару,
│                                 #    статистика: общая выручка, топ товаров)
│
├── controllers/                   # КОНТРОЛЛЕРЫ (Controller в MVC)
│   ├── auth_controller.py        # Контроллер авторизации
│   │                             # - /auth/login - вход в систему
│   │                             # - /auth/logout - выход из системы
│   │                             # - /auth/register - регистрация (создает кассира по умолчанию)
│   │
│   ├── products_controller.py   # Контроллер товаров
│   │                             # - /products/ - список товаров с фильтрацией
│   │                             # - /products/create - создание товара (только админ)
│   │                             # - /products/<id>/edit - редактирование товара (только админ)
│   │                             # - /products/<id>/delete - удаление товара (только админ)
│   │                             # - /products/discounts - управление скидками (только админ)
│   │                             # - /products/<id>/set_discount - установка/удаление скидки
│   │
│   ├── sales_controller.py      # Контроллер продаж
│   │                             # - /sales/ - список всех продаж (админ) или своих (кассир)
│   │                             # - /sales/create - оформление продажи (кассир)
│   │                             #   * Поддержка продажи нескольких товаров за раз (корзина)
│   │                             # - /sales/statistics - статистика продаж (только админ)
│   │                             # - /sales/daily_report - отчет за день (только админ)
│   │                             # - /sales/my_sales - мои продажи (только кассир)
│   │
│   └── users_controller.py      # Контроллер пользователей
│                                 # - /users/ - список пользователей (только админ)
│                                 # - /users/create - создание пользователя (только админ)
│                                 # - /users/<id>/edit - редактирование пользователя (только админ)
│                                 # - /users/<id>/delete - удаление пользователя (только админ)
│
├── views/                         # ПРЕДСТАВЛЕНИЯ (View в MVC) - HTML шаблоны
│   ├── index.html                # Главная страница
│   │
│   ├── auth/                     # Страницы авторизации
│   │   ├── login.html            # Страница входа
│   │   └── register.html         # Страница регистрации
│   │
│   ├── products/                 # Страницы товаров
│   │   ├── list.html             # Список товаров с фильтрацией
│   │   ├── create.html           # Форма создания товара
│   │   ├── edit.html             # Форма редактирования товара
│   │   └── discounts.html        # Управление скидками
│   │
│   ├── sales/                    # Страницы продаж
│   │   ├── list.html             # Список всех продаж (с проверкой роли в навигации)
│   │   ├── create.html           # Форма оформления продажи с корзиной (несколько товаров)
│   │   ├── statistics.html       # Статистика продаж (с проверкой роли в навигации)
│   │   ├── daily_report.html     # Отчет за день (с проверкой роли в навигации)
│   │   └── my_sales.html         # Мои продажи (для кассира)
│   │
│   └── users/                    # Страницы пользователей
│       ├── list.html             # Список пользователей
│       ├── create.html           # Форма создания пользователя
│       └── edit.html             # Форма редактирования пользователя
│
└── static/                       # Статические файлы
    └── style.css                 # CSS стили (минималистичный дизайн в женском стиле)

БАЗА ДАННЫХ (SQLite)
--------------------
Файл: app/cosmeticshop.db (создается автоматически при первом запуске)

ТАБЛИЦА: users
--------------
id              INTEGER PRIMARY KEY    - Уникальный идентификатор
username        VARCHAR(50) UNIQUE     - Имя пользователя (уникальное)
password_hash   VARCHAR(128)           - Хэш пароля (Werkzeug)
role            VARCHAR(20)            - Роль: 'cashier' или 'director'
full_name       VARCHAR(100)           - Полное имя (опционально)
created_at      DATETIME              - Дата создания

Связи:
- users.id -> sales.cashier_id (один ко многим)

ТАБЛИЦА: products
-----------------
id              INTEGER PRIMARY KEY    - Уникальный идентификатор
name            VARCHAR(200)           - Название товара
article         VARCHAR(50)            - Артикул (опционально)
package         VARCHAR(100)           - Упаковка (опционально)
category        VARCHAR(100)           - Категория товара
price           NUMERIC(10,2)          - Обычная цена
discount_price  NUMERIC(10,2)          - Цена со скидкой (опционально)
stock_quantity  INTEGER                - Количество на складе
description     TEXT                   - Описание (опционально)
created_at      DATETIME               - Дата создания

Связи:
- products.id -> sales.product_id (один ко многим)

ТАБЛИЦА: sales
--------------
id              INTEGER PRIMARY KEY    - Уникальный идентификатор
product_id      INTEGER                - ID товара (FK -> products.id)
cashier_id      INTEGER                - ID кассира (FK -> users.id)
quantity        INTEGER                - Количество проданного товара
total_price     NUMERIC(10,2)          - Общая сумма продажи
sale_date       DATETIME               - Дата и время продажи

Связи:
- sales.product_id -> products.id (многие к одному)
- sales.cashier_id -> users.id (многие к одному)

РОЛИ ПОЛЬЗОВАТЕЛЕЙ
------------------
1. ДИРЕКТОР (director)
   - Полный доступ ко всем функциям
   - Управление товарами (CRUD)
   - Управление пользователями (CRUD)
   - Управление скидками
   - Просмотр всех продаж
   - Статистика и отчеты
   - Тестовый аккаунт: логин "1", пароль "1"

2. КАССИР (cashier)
   - Просмотр товаров
   - Оформление продаж
   - Просмотр своих продаж
   - Тестовый аккаунт: логин "2", пароль "2"

ОСНОВНОЙ ФУНКЦИОНАЛ
-------------------
✓ Регистрация и авторизация пользователей
✓ Хэширование паролей (Werkzeug)
✓ Система ролей (кассир/директор)
✓ CRUD для товаров (только директор)
✓ CRUD для пользователей (только директор)
✓ Фильтрация товаров (по категории, названию)
✓ Оформление продаж (кассир)
✓ Продажа нескольких товаров за раз (корзина)
✓ Подтверждение продажи галочкой
✓ Автоматическое уменьшение остатков при продаже
✓ Проверка наличия товаров перед оформлением продажи
✓ Управление скидками (директор)
✓ Использование цены со скидкой при продаже
✓ Статистика продаж (директор)
✓ Отчет за день с детализацией (директор)
✓ Мои продажи (кассир)
✓ Артикул и упаковка товаров
✓ Правильное отображение навигационных меню в зависимости от роли пользователя

АРХИТЕКТУРА
-----------
Паттерн: MVC (Model-View-Controller)

Model (app/models/):
- Доменные классы (User, Product, Sale)
- Репозитории для работы с данными (UserRepo, ProductRepo, SaleRepo)

View (app/views/):
- HTML шаблоны Jinja2
- Отображение данных пользователю

Controller (app/controllers/):
- Обработка HTTP запросов
- Валидация данных
- Вызов методов репозиториев
- Возврат шаблонов

ТЕСТИРОВАНИЕ
------------
Файл: test_cosmeticshop.py
Количество тестов: 25
Используется: pytest

Тесты покрывают:
- Регистрацию и авторизацию
- CRUD операции для товаров
- CRUD операции для пользователей
- Продажи и подтверждение
- Фильтрацию
- Разграничение доступа по ролям
- Скидки
- Статистику

ЗАВИСИМОСТИ
-----------
Flask==3.1.2              - Веб-фреймворк
Flask-Login==0.6.3        - Управление сессиями пользователей
Flask-SQLAlchemy==3.1.1   - ORM для работы с БД
Werkzeug==3.1.4           - Утилиты (хэширование паролей)
SQLAlchemy==2.0.45        - ORM
pytest==7.4.3             - Фреймворк для тестирования
pytest-flask==1.3.0       - Плагин pytest для Flask



